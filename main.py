import streamlit as st
import random
import time
import datetime

st.set_page_config(page_title="ğŸ”® æœ¬æ ¼é‹å‹¢ã‚¬ãƒãƒ£", layout="centered")

st.title("ğŸ”®é‹å‹¢ã‚¬ãƒãƒ£")

# ---------------------------
# æ˜Ÿåº§åˆ¤å®š
# ---------------------------
zodiac_info = {
    "å±±ç¾Šåº§": {"dates": "12/22 - 1/19", "traits": "ç¾å®Ÿçš„ãƒ»åŠªåŠ›å®¶ãƒ»è²¬ä»»æ„ŸãŒå¼·ã„", "advice": "è¨ˆç”»çš„ã«è¡Œå‹•ã™ã‚‹ã¨é‹æ°—UP"},
    "æ°´ç“¶åº§": {"dates": "1/20 - 2/18", "traits": "ç‹¬å‰µçš„ãƒ»è‡ªç”±ãƒ»ç¤¾äº¤çš„", "advice": "æ–°ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’å½¢ã«ã™ã‚‹ã¨å‰"},
    "é­šåº§": {"dates": "2/19 - 3/20", "traits": "æ„Ÿå—æ€§è±Šã‹ãƒ»ç›´æ„Ÿçš„ãƒ»å„ªã—ã„", "advice": "ç›´æ„Ÿã‚’ä¿¡ã˜ã¦è¡Œå‹•ã™ã‚‹ã¨è‰¯ã„"},
    "ç‰¡ç¾Šåº§": {"dates": "3/21 - 4/19", "traits": "è¡Œå‹•åŠ›ãƒ»æŒ‘æˆ¦å¿ƒãƒ»å‰å‘ã", "advice": "æ€ã„åˆ‡ã£ãŸæŒ‘æˆ¦ãŒå‰"},
    "ç‰¡ç‰›åº§": {"dates": "4/20 - 5/20", "traits": "å®‰å®šå¿—å‘ãƒ»ç²˜ã‚Šå¼·ã„ãƒ»ç¾çš„æ„Ÿè¦š", "advice": "ã‚†ã£ãã‚Šç€å®Ÿã«é€²ã‚€ã¨é‹æ°—ä¸Šæ˜‡"},
    "åŒå­åº§": {"dates": "5/21 - 6/21", "traits": "å¥½å¥‡å¿ƒæ—ºç››ãƒ»ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä¸Šæ‰‹", "advice": "æƒ…å ±äº¤æ›ã‚„å­¦ã³ãŒé‹æ°—UP"},
    "èŸ¹åº§": {"dates": "6/22 - 7/22", "traits": "å®¶åº­çš„ãƒ»æ„Ÿå—æ€§è±Šã‹ãƒ»æ€ã„ã‚„ã‚Š", "advice": "èº«è¿‘ãªäººã¨ã®æ™‚é–“ã‚’å¤§åˆ‡ã«ã™ã‚‹ã¨å‰"},
    "ç…å­åº§": {"dates": "7/23 - 8/22", "traits": "è‡ªä¿¡å®¶ãƒ»ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ãƒ»æƒ…ç†±çš„", "advice": "è‡ªå·±è¡¨ç¾ãŒé‹æ°—å‘ä¸Š"},
    "ä¹™å¥³åº§": {"dates": "8/23 - 9/22", "traits": "åˆ†æåŠ›ãƒ»å‡ å¸³é¢ãƒ»å®Ÿå‹™çš„", "advice": "æ•´ç†æ•´é “ã‚„è¨ˆç”»ãŒå‰"},
    "å¤©ç§¤åº§": {"dates": "9/23 - 10/23", "traits": "èª¿å’Œãƒ»ç¤¾äº¤æ€§ãƒ»ç¾æ„è­˜", "advice": "äººé–“é–¢ä¿‚ã‚’å¤§äº‹ã«ã™ã‚‹ã¨é‹æ°—UP"},
    "è åº§": {"dates": "10/24 - 11/22", "traits": "æƒ…ç†±çš„ãƒ»æ´å¯ŸåŠ›ãƒ»ç§˜å¯†ä¸»ç¾©", "advice": "é›†ä¸­åŠ›ã‚’æ´»ã‹ã™ã¨å‰"},
    "å°„æ‰‹åº§": {"dates": "11/23 - 12/21", "traits": "è‡ªç”±ãƒ»å†’é™ºå¿ƒãƒ»æ¥½è¦³çš„", "advice": "æ–°ã—ã„æŒ‘æˆ¦ãŒé‹æ°—UP"}
}

def get_zodiac(month, day):
    zodiac_dates = [
        ((1, 20), "å±±ç¾Šåº§"), ((2, 19), "æ°´ç“¶åº§"),
        ((3, 21), "é­šåº§"), ((4, 20), "ç‰¡ç¾Šåº§"),
        ((5, 21), "ç‰¡ç‰›åº§"), ((6, 22), "åŒå­åº§"),
        ((7, 23), "èŸ¹åº§"), ((8, 23), "ç…å­åº§"),
        ((9, 23), "ä¹™å¥³åº§"), ((10, 24), "å¤©ç§¤åº§"),
        ((11, 23), "è åº§"), ((12, 22), "å°„æ‰‹åº§"),
        ((12, 32), "å±±ç¾Šåº§")
    ]
    for (m, d), sign in zodiac_dates:
        if (month, day) < (m, d):
            return sign

# ---------------------------
# ã‚¿ãƒ­ãƒƒãƒˆï¼ˆå¤§ã‚¢ãƒ«ã‚«ãƒŠï¼‰
# ---------------------------
tarot_cards = {
    # --- å¤§ã‚¢ãƒ«ã‚«ãƒŠ ---
    "æ„šè€…": {"meaning": "æ–°ã—ã„å§‹ã¾ã‚Šãƒ»è‡ªç”±ãƒ»å†’é™ºå¿ƒ", "advice": "æã‚ŒãšæŒ‘æˆ¦ã—ã‚ˆã†"},
    "é­”è¡“å¸«": {"meaning": "å‰µé€ åŠ›ãƒ»è¡Œå‹•åŠ›ãƒ»é›†ä¸­åŠ›", "advice": "æ‰èƒ½ã‚’æ´»ã‹ã—ã¦è¡Œå‹•"},
    "å¥³æ•™çš‡": {"meaning": "ç›´æ„Ÿãƒ»çŸ¥è­˜ãƒ»é™å¯‚", "advice": "ç›´æ„Ÿã‚’ä¿¡ã˜å†…é¢ã‚’è¦‹ã¤ã‚ã‚‹"},
    "å¥³å¸": {"meaning": "è±Šã‹ã•ãƒ»æ„›æƒ…ãƒ»å®Ÿã‚Š", "advice": "æ„Ÿè¬ã®æ°—æŒã¡ã‚’å¤§åˆ‡ã«"},
    "çš‡å¸": {"meaning": "å®‰å®šãƒ»æ¨©å¨ãƒ»è²¬ä»»", "advice": "ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®"},
    "æ³•ç‹": {"meaning": "ä¼çµ±ãƒ»æ•™ãˆãƒ»å­¦ã³", "advice": "ãƒ«ãƒ¼ãƒ«ã‚„æ•™ãˆã‚’å®ˆã‚‹ã¨å‰"},
    "æ‹äºº": {"meaning": "æ„›ãƒ»é¸æŠãƒ»èª¿å’Œ", "advice": "äººé–“é–¢ä¿‚ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å¤§äº‹ã«"},
    "æˆ¦è»Š": {"meaning": "å‹åˆ©ãƒ»å‰é€²ãƒ»æ±ºæ„", "advice": "è¿·ã‚ãšè¡Œå‹•ã™ã‚‹ã¨æˆæœ"},
    "åŠ›": {"meaning": "å‹‡æ°—ãƒ»å¿è€ãƒ»å„ªã—ã•", "advice": "å„ªã—ã•ã‚’ã‚‚ã£ã¦æŒ‘æˆ¦"},
    "éš è€…": {"meaning": "å†…çœãƒ»çŸ¥æµãƒ»å­¤ç‹¬", "advice": "è‡ªåˆ†ã®å†…é¢ã‚’æ·±ã‚ã‚‹æ™‚é–“ã‚’"},
    "é‹å‘½ã®è¼ª": {"meaning": "è»¢æ©Ÿãƒ»ãƒãƒ£ãƒ³ã‚¹ãƒ»å¤‰åŒ–", "advice": "æµã‚Œã«ä¹—ã‚‹ã¨å¹¸é‹ãŒèˆã„è¾¼ã‚€"},
    "æ­£ç¾©": {"meaning": "å…¬å¹³ãƒ»ãƒãƒ©ãƒ³ã‚¹ãƒ»åˆ¤æ–­", "advice": "å†·é™ã«åˆ¤æ–­ã™ã‚‹ã“ã¨ãŒå‰"},
    "åŠã‚‹ã•ã‚ŒãŸç”·": {"meaning": "çŠ ç‰²ãƒ»å¿è€ãƒ»è¦–ç‚¹ã®è»¢æ›", "advice": "ç„¦ã‚‰ãšçŠ¶æ³ã‚’è¦‹æ¥µã‚ã‚‹"},
    "æ­»ç¥": {"meaning": "çµ‚ã‚ã‚Šãƒ»å¤‰åŒ–ãƒ»å†ç”Ÿ", "advice": "å¤‰åŒ–ã‚’å—ã‘å…¥ã‚Œã‚‹ã¨é‹æ°—UP"},
    "ç¯€åˆ¶": {"meaning": "èª¿å’Œãƒ»ãƒãƒ©ãƒ³ã‚¹ãƒ»ç¯€åº¦", "advice": "éä¸è¶³ãªãè¡Œå‹•ã™ã‚‹ã¨å‰"},
    "æ‚ªé­”": {"meaning": "æŸç¸›ãƒ»èª˜æƒ‘ãƒ»åŸ·ç€", "advice": "åŸ·ç€ã‚’æ‰‹æ”¾ã™ã¨å‰"},
    "å¡”": {"meaning": "å´©å£Šãƒ»é©šããƒ»å¤‰åŒ–", "advice": "è¡æ’ƒã‚‚å‰å‘ãã«æ‰ãˆã‚ˆã†"},
    "æ˜Ÿ": {"meaning": "å¸Œæœ›ãƒ»ç™’ã—ãƒ»å¤¢", "advice": "å¸Œæœ›ã‚’æŒã£ã¦è¡Œå‹•ã™ã‚‹ã¨å‰"},
    "æœˆ": {"meaning": "ä¸å®‰ãƒ»ç›´æ„Ÿãƒ»å¹»æƒ³", "advice": "è¿·ã†æ™‚ã¯ç›´æ„Ÿã‚’ä¿¡ã˜ã‚‹"},
    "å¤ªé™½": {"meaning": "æˆåŠŸãƒ»å¹¸ç¦ãƒ»å–œã³", "advice": "ãƒã‚¸ãƒ†ã‚£ãƒ–ã«è¡Œå‹•ã™ã‚‹ã¨é‹æ°—UP"},
    "å¯©åˆ¤": {"meaning": "å†ç”Ÿãƒ»è©•ä¾¡ãƒ»æ±ºæ–­", "advice": "éå»ã‚’æŒ¯ã‚Šè¿”ã‚Šå­¦ã³ã«å¤‰ãˆã‚‹"},
    "ä¸–ç•Œ": {"meaning": "å®Œæˆãƒ»é”æˆãƒ»çµ±åˆ", "advice": "åŠªåŠ›ã®æˆæœã‚’å–œã¶"}
}

# ---------------------------
# äº”è¡Œï¼ˆé¢¨æ°´ï¼‰
# ---------------------------
# ---------------------------
# äº”è¡Œï¼ˆé¢¨æ°´ï¼‰ï¼‹è©³ç´°è§£èª¬
# ---------------------------
elements = {
    "æœ¨": {
        "colors": ["ç·‘", "é’ç·‘"],
        "traits": "æˆé•·ãƒ»ç™ºå±•ãƒ»æŸ”è»Ÿæ€§ãƒ»å‰µé€ åŠ›",
        "season": "æ˜¥",
        "direction": "æ±",
        "body_mind": "è‚è‡“ãƒ»ç›®ãƒ»è¨ˆç”»åŠ›ã«é–¢ä¿‚",
        "advice": "æ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã—ãŸã‚Šã€å­¦ã³ã‚„ç™ºå±•ã‚’æ„è­˜ã™ã‚‹ã¨å‰"
    },
    "ç«": {
        "colors": ["èµ¤", "ã‚ªãƒ¬ãƒ³ã‚¸"],
        "traits": "æƒ…ç†±ãƒ»è¡Œå‹•åŠ›ãƒ»æ´»åŠ›ãƒ»ç›´æ„Ÿ",
        "season": "å¤",
        "direction": "å—",
        "body_mind": "å¿ƒè‡“ãƒ»è¡€ãƒ»å‹‡æ°—ã«é–¢ä¿‚",
        "advice": "ç©æ¥µçš„ã«å‹•ãã“ã¨ã§é‹æ°—UPã€‚æ–°ã—ã„æŒ‘æˆ¦ã«å‰"
    },
    "åœŸ": {
        "colors": ["é»„è‰²", "èŒ¶è‰²"],
        "traits": "å®‰å®šãƒ»è“„ç©ãƒ»å®‰å¿ƒæ„Ÿãƒ»å¿è€",
        "season": "åœŸç”¨ï¼ˆå­£ç¯€ã®å¤‰ã‚ã‚Šç›®ï¼‰",
        "direction": "ä¸­å¤®",
        "body_mind": "èƒƒãƒ»æ¶ˆåŒ–ãƒ»å¿è€åŠ›ã«é–¢ä¿‚",
        "advice": "åœ°ã«è¶³ã‚’ã¤ã‘ã¦è¨ˆç”»ãƒ»æ•´ç†æ•´é “ã™ã‚‹ã¨å‰"
    },
    "é‡‘": {
        "colors": ["ç™½", "ã‚´ãƒ¼ãƒ«ãƒ‰"],
        "traits": "æˆåŠŸãƒ»æ•´ç†ãƒ»çŸ¥æµãƒ»æ±ºæ–­åŠ›",
        "season": "ç§‹",
        "direction": "è¥¿",
        "body_mind": "è‚ºãƒ»å‘¼å¸ãƒ»é›†ä¸­åŠ›ã«é–¢ä¿‚",
        "advice": "çŸ¥è­˜ç¿’å¾—ã‚„æ•´ç†æ•´é “ã§é‹æ°—å‘ä¸Šã€‚æ±ºæ–­ã‚‚å‰"
    },
    "æ°´": {
        "colors": ["é’", "é»’"],
        "traits": "æµå‹•ãƒ»ç›´æ„Ÿãƒ»æŸ”è»Ÿãƒ»å†·é™",
        "season": "å†¬",
        "direction": "åŒ—",
        "body_mind": "è…è‡“ãƒ»è€³ãƒ»æ„Ÿå—æ€§ã«é–¢ä¿‚",
        "advice": "æµã‚Œã«èº«ã‚’ä»»ã›ã€æŸ”è»Ÿã«è¡Œå‹•ã™ã‚‹ã¨ãƒãƒ£ãƒ³ã‚¹åˆ°æ¥"
    }
}


# ---------------------------
# session state
# ---------------------------
if "history" not in st.session_state:
    st.session_state.history = []

# ---------------------------
# ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›
# ---------------------------
birth = st.date_input(
    "ğŸ‚ ç”Ÿå¹´æœˆæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
    min_value=datetime.date(1900, 1, 1),
    max_value=datetime.date.today(),
    value=datetime.date(1995, 1, 1)
)

mood = st.radio("ğŸ˜Š ä»Šã®æ°—åˆ†ã¯ï¼Ÿ", ["æœ€é«˜ï¼", "æ™®é€š", "ã¡ã‚‡ã£ã¨ç–²ã‚ŒãŸ"])

placeholder = st.empty()

# ---------------------------
# ãƒ¡ã‚¤ãƒ³å‡¦ç†
# ---------------------------
if st.button("ğŸ”® é‹å‹¢ã‚’å ã†"):
    
    with st.spinner("å®‡å®™ã¨äº¤ä¿¡ä¸­..."):
        for i in range(3, 0, -1):
            placeholder.markdown(f"# âœ¨ {i} âœ¨")
            time.sleep(1)

    today = datetime.date.today()
    
    # seedã§æ—¥æ›¿ã‚ã‚Šï¼‹å€‹äººå·®
    seed_value = birth.day + birth.month + today.day
    random.seed(seed_value)

    # æ˜Ÿåº§
    zodiac = get_zodiac(birth.month, birth.day)

    # ã‚¿ãƒ­ãƒƒãƒˆ
    tarot = random.choice(list(tarot_cards.keys()))
    position = random.choice(["æ­£ä½ç½®", "é€†ä½ç½®"])
    tarot_meaning = tarot_cards[tarot]

    # äº”è¡Œ
    # äº”è¡Œãƒ©ãƒ³ãƒ€ãƒ é¸æŠ
    element = random.choice(list(elements.keys()))
    lucky_color = random.choice(elements[element]["colors"])
    element_detail = elements[element]


    # é‹æ°—ã‚¹ã‚³ã‚¢
    base_score = random.randint(1, 100)

    # æ°—åˆ†è£œæ­£
    if mood == "æœ€é«˜ï¼":
        base_score += 10
    elif mood == "ã¡ã‚‡ã£ã¨ç–²ã‚ŒãŸ":
        base_score -= 10

    luck_score = max(1, min(100, base_score))

    # é‹å‹¢åˆ¤å®š
    if luck_score >= 90:
        fortune = "ğŸŒŸ å¤§å‰"
        st.balloons()
    elif luck_score >= 70:
        fortune = "âœ¨ ä¸­å‰"
    elif luck_score >= 50:
        fortune = "ğŸ˜Š å‰"
    elif luck_score >= 30:
        fortune = "âš  å°å‰"
    else:
        fortune = "ğŸ’€ å‡¶"

    # ãƒŸãƒƒã‚·ãƒ§ãƒ³ç”Ÿæˆ
    missions = {
        "å¤§å‰": "å¤§èƒ†ãªæŒ‘æˆ¦ã‚’ã—ã‚ˆã†ï¼",
        "ä¸­å‰": "å‰å‘ããªè¡Œå‹•ã‚’å¿ƒãŒã‘ã‚‹",
        "å‰": "ã‚³ãƒ„ã‚³ãƒ„ç¶™ç¶š",
        "å°å‰": "ç„¦ã‚‰ãšæ…é‡ã«",
        "å‡¶": "ç„¡ç†ã›ãšä¼‘æ¯ã‚’"
    }

    mission = missions[fortune.replace("ğŸŒŸ ","").replace("âœ¨ ","").replace("ğŸ˜Š ","").replace("âš  ","").replace("ğŸ’€ ","")]

    # è¡¨ç¤º
    zodiac_detail = zodiac_info[zodiac]
    st.markdown(f"### ğŸŒŒ æ˜Ÿåº§: **{zodiac}**")
    st.markdown(f"**æ€§æ ¼ãƒ»ç‰¹å¾´:** {zodiac_detail['traits']}")
    st.markdown(f"**ä»Šæ—¥ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹:** {zodiac_detail['advice']}")

    tarot_detail = tarot_cards[tarot]
    st.markdown(f"### ğŸƒ ã‚¿ãƒ­ãƒƒãƒˆ: **{tarot}ï¼ˆ{position}ï¼‰**")
    st.markdown(f"**æ„å‘³:** {tarot_detail['meaning']}")
    st.markdown(f"**ä»Šæ—¥ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹:** {tarot_detail['advice']}")

    element_detail = elements[element]
    lucky_color = random.choice(element_detail["colors"])
    st.markdown(f"### ğŸ® äº”è¡Œ: **{element}**")
    st.markdown(f"**ç‰¹å¾´:** {element_detail['traits']}")
    st.markdown(f"**å­£ç¯€:** {element_detail['season']}")
    st.markdown(f"**æ–¹å‘:** {element_detail['direction']}")
    st.markdown(f"**ä½“ãƒ»å¿ƒã®å½±éŸ¿:** {element_detail['body_mind']}")
    st.markdown(f"**ä»Šæ—¥ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹:** {element_detail['advice']}")
    st.markdown(f"### ğŸ¨ ãƒ©ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ¼: **{lucky_color}**")

    result = {
        "fortune": fortune,
        "zodiac": zodiac,
        "tarot": tarot,
        "score": luck_score
    }

    st.session_state.history.append(result)

# ---------------------------
# å±¥æ­´è¡¨ç¤º
# ---------------------------
if st.session_state.history:
    st.subheader("ğŸ“œ éå»ã®å ã„å±¥æ­´")
    for item in reversed(st.session_state.history):
        st.write(item)

# ---------------------------
# SNSã‚·ã‚§ã‚¢ãƒ†ã‚­ã‚¹ãƒˆ
# ---------------------------
if st.session_state.history:
    latest = st.session_state.history[-1]
    share_text = f"""
ğŸ”® ä»Šæ—¥ã®é‹å‹¢ ğŸ”®
é‹å‹¢: {latest['fortune']}
æ˜Ÿåº§: {latest['zodiac']}
ã‚¿ãƒ­ãƒƒãƒˆ: {latest['tarot']}
ã‚¹ã‚³ã‚¢: {latest['score']}/100

#100DaysOfCode #Streamlit
"""
    st.text_area("ğŸ“¢ ã‚·ã‚§ã‚¢ç”¨ãƒ†ã‚­ã‚¹ãƒˆ", share_text)
